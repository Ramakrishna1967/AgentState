# AgentStack: Detailed Pending Work (The "Next 6")

While the core functionality of AgentStack is hardened and production-ready, there are **6 major pending tasks** required to bring the project to its ultimate vision. Below is a highly detailed breakdown of each pending work item, why it is needed, and the specific implementation steps.

---

## 1. Time Machine (Execution Replay System)
**Status:** _Done (Day 3)_
**Location:** Dashboard (Frontend) + API Backend

**Explanation:**  
The "Time Machine" feature is the core differentiator for AgentStack. It allows developers to "rewind" and replay an agent's reasoning step-by-step to see exactly where a hallucination or failure occurred.
**Implementation Details:**
- **Backend:** Create a new FastAPI route (`GET /api/projects/{id}/traces/{trace_id}/replay`) that streams the sequential span data ordered by timestamps. *(Completed: `get_trace_replay` in `traces.py`)*
- **Frontend:** Build a `ReplayViewer.tsx` component in the React dashboard with playback controls (Play, Pause, Step Forward, Step Back). *(Completed: `ReplayViewer.tsx` integrated via toggle in `TraceView.tsx`)*
- **Data Model:** Ensure that the ClickHouse spans include the full `input_payload` and `output_payload` to accurately reconstruct the exact state of the agent at every given microsecond. *(Completed: Demo Agent generator created to simulate payload logic)*

---

## 2. Framework Auto-Instrumentation (CrewAI & AutoGen)
**Status:** _Done (Day 3)_
**Location:** `agentstack/packages/sdk-python/src/agentstack/frameworks/`

**Explanation:**  
Currently, the SDK requires manual span creation. The project architecture defines auto-instrumentation for popular frameworks, but `crewai.py` and `autogen.py` are currently only no-op stubs that contain `# TODO: Implement auto-instrumentation` comments.
**Implementation Details:**
- **CrewAI (`crewai.py`):** Hook into CrewAI's `Agent` and `Task` execution lifecycles. Wrap the `execute_task` method to automatically create a span containing the prompt, tools used, and the generated output. *(Completed: Monkey-patched `Task.execute` and `Agent.execute_task`)*
- **AutoGen (`autogen.py`):** Create hooks for `ConversableAgent` to trace messages sent and received. Intercept the `generate_reply` method to automatically record the interaction as a trace. *(Completed: Monkey-patched `generate_reply` and `receive`)*

---

## 3. Instrumentation Demo & Examples
**Status:** _Done (Day 3)_
**Location:** `/examples`

**Explanation:**  
A project of this complexity needs an immediate "wow factor" when cloned. There is currently no active example script to generate real dummy data for the dashboard.
**Implementation Details:**
- Created a `demo_agent.py` script in `/examples` using LangGraph manually instanced tracing.
- The script simulates a multi-step workflow (retrieving context from a vector DB, summarizing it, and writing an email).
- Include intentional simulated errors and prompt injections to demonstrate the security and anomaly detection engines in the Dashboard. *(Completed: `demo_agent.py`)*

---

## 4. Dashboard Visualization Polish (Recharts Integration)
**Status:** _Done (Day 3)_
**Location:** `agentstack/packages/dashboard/src/components/`

**Explanation:**  
The dashboard relies on visual metrics to convey observability. While the data is available from the API, the actual charting library (`recharts`) needs to be fully implemented to visualize trace volume and token costs visually over time.
**Implementation Details:**
- **Cost Analysis:** Implemented `<CostChart />` and `<TokenUsageChart />` using `recharts` to map LLM spending per project against a timeline.
- **Security Metrics:** Added trend lines for "Detected Anomalies" and "Prompt Injections Blocked" per day.
- **Trace Latency:** Built a scatter plot showing the average latency of external API calls vs LLM generation times.

---

## 5. Load Testing & Benchmarking 
**Status:** _Done (Day 3)_
**Location:** `scripts/benchmark.py`

**Explanation:**  
The architecture docs promise high performance (up to 20k spans/sec via Redis Streams & ClickHouse). This needs to be mathematically proven with an load-testing script to establish credibility for the Open-Source release.
**Implementation Details:**
- Written an asynchronous Python script (`benchmark.py`) using `aiohttp` to spam the Collector (`/v1/spans`) with thousands of requests per second.
- **Metrics Collected:** Tracked the ingestion rate, average latency of 200 OK responses, system CPU/Memory overhead, and the consumer throughput (Clickhouse Writer speed).
- Results tracked and proven via `BENCHMARKS.md`.

---

## 6. Full CI/CD Pipeline Automation
**Status:** _Done (Day 3)_
**Location:** `.github/workflows/`

**Explanation:**  
Since the project is built out of 5 separate packages (SDK, API, Collector, UI, Workers), a robust multi-package CI pipeline is critical to ensure PRs don't break the hardened security posture.
**Implementation Details:**
- **Continuous Integration (`ci.yml`):** Runs `pytest` and `flake8` for the Python packages. Runs `npm run build` and `npm run test` for the React dashboard.
- **Security Scanning:** Integrated `bandit` vulnerability scanner in the pipeline to ensure no future regressions reverse the 22 security fixes made.
- **Automated Releases (`release.yml`):** Created a GitHub Action that triggers on git tags `v*` to automatically publish the `agentstack` SDK to PyPI, and Docker images to Docker Hub.































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































